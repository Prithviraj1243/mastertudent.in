<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced Admin Dashboard - Student Notes Marketplace</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f0f0f;
            color: #ffffff;
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(255, 107, 53, 0.3);
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .nav-tabs {
            background: #1a1a1a;
            padding: 0 2rem;
            display: flex;
            gap: 0.5rem;
            border-bottom: 1px solid #333;
        }

        .nav-tab {
            padding: 1rem 1.5rem;
            background: none;
            border: none;
            color: #888;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .nav-tab.active {
            color: #ff6b35;
            border-bottom-color: #ff6b35;
        }

        .nav-tab:hover {
            color: #fff;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: #1a1a1a;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            border: 1px solid #333;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #ff6b35;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            color: #888;
            font-size: 0.9rem;
        }

        .notes-section {
            background: #1a1a1a;
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid #333;
        }

        .notes-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .notes-header h2 {
            color: #fff;
            font-size: 1.25rem;
        }

        .filters {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .filter-select {
            background: #2a2a2a;
            color: #fff;
            border: 1px solid #444;
            padding: 0.5rem;
            border-radius: 6px;
        }

        .note-item {
            background: #2a2a2a;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid #444;
            transition: all 0.3s ease;
            position: relative;
        }

        .note-item:hover {
            border-color: #ff6b35;
            box-shadow: 0 8px 30px rgba(255, 107, 53, 0.15);
            transform: translateY(-2px);
        }

        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .note-info {
            flex: 1;
        }

        .note-info h3 {
            color: #fff;
            margin-bottom: 0.5rem;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .note-meta {
            display: flex;
            gap: 1rem;
            color: #888;
            font-size: 0.875rem;
            margin-bottom: 0.75rem;
            flex-wrap: wrap;
        }

        .user-profile-card {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border: 1px solid #333;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #ff6b35, #f7931e);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            color: white;
        }

        .user-details h4 {
            color: #fff;
            margin-bottom: 0.25rem;
        }

        .user-details p {
            color: #888;
            font-size: 0.875rem;
        }

        .user-stats {
            display: flex;
            gap: 1rem;
            margin-left: auto;
        }

        .user-stat {
            text-align: center;
        }

        .user-stat-number {
            color: #ff6b35;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .user-stat-label {
            color: #888;
            font-size: 0.75rem;
        }

        .document-preview-section {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            border: 1px solid #333;
        }

        .document-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .document-card {
            background: #2a2a2a;
            border-radius: 6px;
            padding: 1rem;
            border: 1px solid #444;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .document-card:hover {
            border-color: #ff6b35;
            transform: scale(1.02);
        }

        .document-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .document-name {
            color: #fff;
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
            word-break: break-word;
        }

        .document-size {
            color: #888;
            font-size: 0.75rem;
        }

        .note-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-submitted {
            background: #fbbf24;
            color: #92400e;
        }

        .status-approved {
            background: #10b981;
            color: #065f46;
        }

        .status-rejected {
            background: #ef4444;
            color: #991b1b;
        }

        .note-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            transition: all 0.3s ease;
        }

        .btn-preview {
            background: #3b82f6;
            color: white;
        }

        .btn-preview:hover {
            background: #2563eb;
        }

        .btn-approve {
            background: #10b981;
            color: white;
        }

        .btn-approve:hover {
            background: #059669;
        }

        .btn-reject {
            background: #ef4444;
            color: white;
        }

        .btn-reject:hover {
            background: #dc2626;
        }

        .btn-view {
            background: #6366f1;
            color: white;
        }

        .btn-view:hover {
            background: #4f46e5;
        }

        .file-info {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
            color: #888;
            font-size: 0.875rem;
        }

        .preview-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
        }

        .preview-content {
            position: relative;
            width: 90%;
            height: 90%;
            margin: 5% auto;
            background: #1a1a1a;
            border-radius: 12px;
            overflow: hidden;
        }

        .preview-header {
            background: #2a2a2a;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #444;
        }

        .preview-header h3 {
            color: #fff;
        }

        .close-btn {
            background: #ef4444;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
        }

        .preview-body {
            padding: 1rem;
            height: calc(100% - 80px);
            overflow-y: auto;
        }

        .preview-iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: white;
            border-radius: 6px;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #888;
        }

        .error {
            background: #fef2f2;
            color: #dc2626;
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
        }

        .success {
            background: #f0fdf4;
            color: #16a34a;
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
        }

        .quick-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üìä Real Admin Dashboard</h1>
        <div class="user-info">
            <span>Main Admin</span>
            <button class="logout-btn" onclick="logout()">üö™ Logout</button>
        </div>
    </div>

    <div class="nav-tabs">
        <button class="nav-tab active" onclick="showTab('notes')">üìã Live Notes (4)</button>
        <button class="nav-tab" onclick="showTab('users')">üë• Live Users (4)</button>
        <button class="nav-tab" onclick="showTab('transactions')">üí∞ Live Transactions (0)</button>
    </div>

    <div class="container">
        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üìö</div>
                <div class="stat-number" id="totalNotes">4</div>
                <div class="stat-label">Total Notes</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-number" id="approvedNotes">1</div>
                <div class="stat-label">Approved</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚è≥</div>
                <div class="stat-number" id="pendingNotes">3</div>
                <div class="stat-label">Pending</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚¨áÔ∏è</div>
                <div class="stat-number" id="totalDownloads">0</div>
                <div class="stat-label">Downloads</div>
            </div>
        </div>

        <!-- Notes Section -->
        <div class="notes-section">
            <div class="notes-header">
                <h2>üìã Real Notes Database (4 notes)</h2>
                <div class="filters">
                    <select class="filter-select" onchange="filterNotes(this.value)">
                        <option value="all">All Status</option>
                        <option value="submitted">Submitted</option>
                        <option value="approved">Approved</option>
                        <option value="rejected">Rejected</option>
                    </select>
                    <button class="btn btn-preview" onclick="refreshNotes()">üîÑ Refresh</button>
                </div>
            </div>

            <div id="notesList">
                <div class="loading">Loading real notes from database...</div>
            </div>
        </div>
    </div>

    <!-- Preview Modal -->
    <div id="previewModal" class="preview-modal">
        <div class="preview-content">
            <div class="preview-header">
                <h3 id="previewTitle">Document Preview</h3>
                <div>
                    <button class="btn btn-approve" onclick="approveFromPreview()">‚úÖ Approve</button>
                    <button class="btn btn-reject" onclick="rejectFromPreview()">‚ùå Reject</button>
                    <button class="close-btn" onclick="closePreview()">‚úï Close</button>
                </div>
            </div>
            <div class="preview-body" id="previewBody">
                <div class="loading">Loading preview...</div>
            </div>
        </div>
    </div>

    <script>
        const adminToken = localStorage.getItem('adminToken');
        let currentNotes = [];
        let currentPreviewNoteId = null;

        if (!adminToken) {
            window.location.href = '/admin/login';
        }

        // Load notes from database
        async function loadNotes() {
            try {
                const response = await fetch('/api/admin/notes', {
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to load notes');
                }

                const data = await response.json();
                currentNotes = data.notes || [];
                
                // Update statistics
                document.getElementById('totalNotes').textContent = data.stats?.totalNotes || currentNotes.length;
                document.getElementById('approvedNotes').textContent = data.stats?.approved || 0;
                document.getElementById('pendingNotes').textContent = data.stats?.pendingReview || 0;
                document.getElementById('totalDownloads').textContent = data.stats?.totalDownloads || 0;

                renderNotes();
            } catch (error) {
                console.error('Error loading notes:', error);
                document.getElementById('notesList').innerHTML = `<div class="error">Error loading notes: ${error.message}</div>`;
            }
        }

        // Render notes list with enhanced user profiles and document previews
        function renderNotes() {
            const notesList = document.getElementById('notesList');
            
            if (currentNotes.length === 0) {
                notesList.innerHTML = '<div class="loading">No notes found in database</div>';
                return;
            }

            notesList.innerHTML = currentNotes.map(note => `
                <div class="note-item">
                    <div class="note-header">
                        <div class="note-info">
                            <h3>${note.title}</h3>
                            <div class="note-meta">
                                <span>üìö ${note.subject}</span>
                                <span>üìù ${note.topic || 'General'}</span>
                                <span>üìÖ ${new Date(note.createdAt).toLocaleDateString()}</span>
                                <span>‚è∞ ${new Date(note.createdAt).toLocaleTimeString()}</span>
                            </div>
                            ${note.description ? `<p style="color: #ccc; margin: 0.5rem 0; font-size: 0.9rem;">${note.description}</p>` : ''}
                        </div>
                        <div class="note-actions">
                            <span class="note-status status-${note.status}">${note.status}</span>
                        </div>
                    </div>

                    <!-- User Profile Card -->
                    <div class="user-profile-card">
                        <div class="user-avatar">
                            ${getInitials(note.authorName)}
                        </div>
                        <div class="user-details">
                            <h4>${note.authorName}</h4>
                            <p>üìß ${note.authorEmail}</p>
                            <p>üë§ ${note.authorRole || 'Student'} ‚Ä¢ üèÜ Rep: ${note.authorReputation || 0}</p>
                        </div>
                        <div class="user-stats">
                            <div class="user-stat">
                                <div class="user-stat-number">${note.authorTotalNotes || 1}</div>
                                <div class="user-stat-label">Notes</div>
                            </div>
                            <div class="user-stat">
                                <div class="user-stat-number">${note.authorTotalDownloads || 0}</div>
                                <div class="user-stat-label">Downloads</div>
                            </div>
                            <div class="user-stat">
                                <div class="user-stat-number">${note.coinBalance || 0}</div>
                                <div class="user-stat-label">Coins</div>
                            </div>
                        </div>
                    </div>

                    <!-- Document Preview Section -->
                    <div class="document-preview-section">
                        <h4 style="color: #fff; margin-bottom: 0.5rem;">üìÅ Attached Documents (${note.fileCount})</h4>
                        <div class="file-info" style="margin-bottom: 1rem;">
                            <span>üíæ Total Size: ${formatFileSize(note.totalFileSize)}</span>
                            ${note.hasPreviewableFiles ? '<span style="color: #10b981;">üëÅÔ∏è Preview Available</span>' : '<span style="color: #f59e0b;">‚¨áÔ∏è Download Only</span>'}
                        </div>
                        
                        <div id="documents-${note.id}" class="document-grid">
                            <div class="loading" style="grid-column: 1 / -1; text-align: center; color: #888;">
                                Loading documents...
                            </div>
                        </div>
                    </div>
                    
                    <div class="quick-actions">
                        <button class="btn btn-preview" onclick="loadNoteDocuments('${note.id}')">üìÅ Load Documents</button>
                        ${note.hasPreviewableFiles ? 
                            `<button class="btn btn-preview" onclick="quickPreview('${note.id}')">üëÅÔ∏è Quick Preview</button>` : 
                            ''
                        }
                        <button class="btn btn-view" onclick="openFullViewer('${note.id}')">üìÑ Full Document Viewer</button>
                        <button class="btn btn-view" onclick="viewUserProfile('${note.authorId}')">üë§ View User Profile</button>
                        ${note.status === 'submitted' ? `
                            <button class="btn btn-approve" onclick="approveNote('${note.id}')">‚úÖ Approve</button>
                            <button class="btn btn-reject" onclick="rejectNote('${note.id}')">‚ùå Reject</button>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Get user initials for avatar
        function getInitials(name) {
            if (!name) return '?';
            return name.split(' ')
                .map(word => word.charAt(0))
                .join('')
                .toUpperCase()
                .substring(0, 2);
        }

        // Load documents for a specific note
        async function loadNoteDocuments(noteId) {
            const documentsContainer = document.getElementById(`documents-${noteId}`);
            documentsContainer.innerHTML = '<div class="loading" style="grid-column: 1 / -1; text-align: center; color: #888;">Loading documents...</div>';

            try {
                const response = await fetch(`/api/admin/notes/${noteId}/files`, {
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to load documents');
                }

                const data = await response.json();
                const files = data.files || [];

                if (files.length === 0) {
                    documentsContainer.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; color: #888;">No documents found</div>';
                    return;
                }

                documentsContainer.innerHTML = files.map(file => `
                    <div class="document-card" onclick="previewDocument('${file.filePath}', '${file.fileName}', '${file.fileExtension}')">
                        <div class="document-icon">${file.icon}</div>
                        <div class="document-name">${file.fileName}</div>
                        <div class="document-size">${formatFileSize(file.fileSize)}</div>
                        ${file.canPreview ? '<div style="color: #10b981; font-size: 0.75rem; margin-top: 0.25rem;">üëÅÔ∏è Previewable</div>' : ''}
                    </div>
                `).join('');
            } catch (error) {
                documentsContainer.innerHTML = `<div style="grid-column: 1 / -1; text-align: center; color: #ef4444;">Error: ${error.message}</div>`;
            }
        }

        // Preview individual document
        function previewDocument(filePath, fileName, fileExtension) {
            const modal = document.getElementById('previewModal');
            const previewBody = document.getElementById('previewBody');
            const previewTitle = document.getElementById('previewTitle');
            
            modal.style.display = 'block';
            previewTitle.textContent = fileName;
            previewBody.innerHTML = '<div class="loading">Loading document...</div>';

            const previewUrl = `/api/admin/files/preview/${encodeURIComponent(filePath)}`;
            
            if (['jpg', 'jpeg', 'png', 'gif'].includes(fileExtension)) {
                previewBody.innerHTML = `
                    <div style="text-align: center;">
                        <img src="${previewUrl}" style="max-width: 100%; max-height: 600px; border-radius: 6px;" alt="${fileName}">
                    </div>
                `;
            } else if (fileExtension === 'pdf') {
                previewBody.innerHTML = `<iframe class="preview-iframe" src="${previewUrl}"></iframe>`;
            } else if (['txt', 'html'].includes(fileExtension)) {
                fetch(previewUrl, {
                    headers: {
                        'Authorization': `Bearer ${adminToken}`,
                        'Accept': 'application/json'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    previewBody.innerHTML = `
                        <pre style="background: #f8f9fa; color: #333; padding: 1rem; border-radius: 6px; white-space: pre-wrap; max-height: 600px; overflow-y: auto;">${escapeHtml(data.content)}</pre>
                    `;
                })
                .catch(error => {
                    previewBody.innerHTML = `<div class="error">Error loading file: ${error.message}</div>`;
                });
            } else {
                previewBody.innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <p>Preview not available for this file type</p>
                        <a href="/api/admin/files/download/${encodeURIComponent(filePath)}" class="btn btn-primary">‚¨áÔ∏è Download ${fileName}</a>
                    </div>
                `;
            }
        }

        // View user profile
        function viewUserProfile(userId) {
            window.open(`/admin/user-profile?userId=${userId}`, '_blank');
        }

        // Quick preview functionality
        async function quickPreview(noteId) {
            currentPreviewNoteId = noteId;
            const modal = document.getElementById('previewModal');
            const previewBody = document.getElementById('previewBody');
            const previewTitle = document.getElementById('previewTitle');
            
            modal.style.display = 'block';
            previewBody.innerHTML = '<div class="loading">Loading preview...</div>';
            previewTitle.textContent = 'Document Preview';

            try {
                const response = await fetch(`/api/admin/notes/${noteId}/quick-preview`, {
                    headers: {
                        'Authorization': `Bearer ${adminToken}`
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to load preview');
                }

                const data = await response.json();
                previewTitle.textContent = `${data.title} - ${data.subject}`;

                if (data.quickPreview && data.quickPreview.canPreview) {
                    const file = data.quickPreview;
                    
                    if (['jpg', 'jpeg', 'png', 'gif'].includes(file.fileExtension)) {
                        previewBody.innerHTML = `
                            <div style="text-align: center;">
                                <img src="${file.previewUrl}" style="max-width: 100%; max-height: 600px; border-radius: 6px;" alt="${file.fileName}">
                                <p style="margin-top: 1rem; color: #888;">${file.fileName}</p>
                            </div>
                        `;
                    } else if (file.fileExtension === 'pdf') {
                        previewBody.innerHTML = `<iframe class="preview-iframe" src="${file.previewUrl}"></iframe>`;
                    } else if (['txt', 'html'].includes(file.fileExtension)) {
                        const textResponse = await fetch(file.previewUrl, {
                            headers: {
                                'Authorization': `Bearer ${adminToken}`,
                                'Accept': 'application/json'
                            }
                        });
                        const textData = await textResponse.json();
                        previewBody.innerHTML = `
                            <pre style="background: #f8f9fa; color: #333; padding: 1rem; border-radius: 6px; white-space: pre-wrap; max-height: 600px; overflow-y: auto;">${escapeHtml(textData.content)}</pre>
                        `;
                    }
                } else {
                    previewBody.innerHTML = `
                        <div style="text-align: center; padding: 2rem;">
                            <p>No previewable files found</p>
                            <button class="btn btn-view" onclick="openFullViewer('${noteId}')">üìÑ View All Files</button>
                        </div>
                    `;
                }
            } catch (error) {
                previewBody.innerHTML = `<div class="error">Error loading preview: ${error.message}</div>`;
            }
        }

        // Open full document viewer
        function openFullViewer(noteId) {
            window.open(`/admin/documents?noteId=${noteId}`, '_blank');
        }

        // Close preview modal
        function closePreview() {
            document.getElementById('previewModal').style.display = 'none';
            currentPreviewNoteId = null;
        }

        // Approve note
        async function approveNote(noteId) {
            if (!confirm('Are you sure you want to approve this note?')) return;
            
            try {
                const response = await fetch(`/api/admin/notes/${noteId}/approve`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    alert('Note approved successfully!');
                    loadNotes(); // Refresh the list
                } else {
                    throw new Error('Failed to approve note');
                }
            } catch (error) {
                alert('Error approving note: ' + error.message);
            }
        }

        // Reject note
        async function rejectNote(noteId) {
            const reason = prompt('Please provide a reason for rejection:');
            if (!reason) return;
            
            try {
                const response = await fetch(`/api/admin/notes/${noteId}/reject`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${adminToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ reason })
                });

                if (response.ok) {
                    alert('Note rejected successfully!');
                    loadNotes(); // Refresh the list
                } else {
                    throw new Error('Failed to reject note');
                }
            } catch (error) {
                alert('Error rejecting note: ' + error.message);
            }
        }

        // Approve from preview modal
        function approveFromPreview() {
            if (currentPreviewNoteId) {
                approveNote(currentPreviewNoteId);
                closePreview();
            }
        }

        // Reject from preview modal
        function rejectFromPreview() {
            if (currentPreviewNoteId) {
                rejectNote(currentPreviewNoteId);
                closePreview();
            }
        }

        // Utility functions
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function refreshNotes() {
            loadNotes();
        }

        function filterNotes(status) {
            // Filter implementation
            if (status === 'all') {
                renderNotes();
            } else {
                const filtered = currentNotes.filter(note => note.status === status);
                const originalNotes = currentNotes;
                currentNotes = filtered;
                renderNotes();
                currentNotes = originalNotes;
            }
        }

        function showTab(tab) {
            // Tab switching implementation
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
        }

        function logout() {
            localStorage.removeItem('adminToken');
            window.location.href = '/admin/login';
        }

        // Initialize
        loadNotes();

        // Auto-refresh every 30 seconds
        setInterval(loadNotes, 30000);
    </script>
</body>
</html>
